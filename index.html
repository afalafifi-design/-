<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة ترتيب الحروف المبعثرة</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap');

        body {
            font-family: 'Amiri', serif;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        h1 {
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        a {
            color: #fff;
            text-decoration: none;
            font-size: 18px;
            margin-bottom: 20px;
            display: inline-block;
            padding: 10px 20px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 25px;
            transition: background-color 0.3s;
        }
        a:hover {
            background-color: rgba(255,255,255,0.4);
        }
        #game {
            max-width: 700px;
            width: 100%;
            background-color: rgba(255,255,255,0.95);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3), 0 0 20px rgba(102, 126, 234, 0.5);
            backdrop-filter: blur(10px);
            animation: fadeIn 1s ease-in;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
        }
        #game::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
            border-radius: 22px;
            z-index: -1;
            animation: glow 3s ease-in-out infinite alternate;
        }
        @keyframes glow {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #timer {
            font-size: 24px;
            margin: 10px 0;
            color: #333;
            font-weight: bold;
        }
        #scrambled {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            min-height: 60px;
        }
        .letter-box {
            width: 50px;
            height: 50px;
            background-color: #007bff;
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .letter-box:hover {
            background-color: #0056b3;
            transform: scale(1.1);
        }
        .letter-box:active {
            transform: scale(0.95);
        }
        #answer-area {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            min-height: 60px;
            border: 2px dashed #28a745;
            padding: 10px;
            border-radius: 10px;
            background-color: rgba(40, 167, 69, 0.1);
        }
        .answer-letter {
            width: 50px;
            height: 50px;
            background-color: #28a745;
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .answer-letter:hover {
            background-color: #1e7e34;
            transform: scale(1.1);
        }
        .answer-letter:active {
            transform: scale(0.95);
        }
        input {
            font-family: 'Amiri', serif;
            font-size: 20px;
            padding: 15px;
            width: 250px;
            text-align: center;
            border: 2px solid #007bff;
            border-radius: 25px;
            outline: none;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:focus {
            border-color: #0056b3;
            box-shadow: 0 0 10px rgba(0,123,255,0.5);
        }
        button {
            font-family: 'Amiri', serif;
            font-size: 18px;
            padding: 12px 25px;
            margin: 10px;
            cursor: pointer;
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 25px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
        }
        button:active {
            transform: translateY(0);
        }
        #message {
            margin: 20px 0;
            font-size: 20px;
            font-weight: bold;
            min-height: 30px;
        }
        .correct {
            color: #28a745;
            animation: bounce 0.5s;
        }
        .incorrect {
            color: #dc3545;
            animation: shake 0.5s;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        #fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            display: none;
        }
        #wrong-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 0, 0, 0.7);
            display: none;
            z-index: 999;
            animation: flash 0.5s ease-in-out;
        }
        @keyframes flash {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        .firework {
            position: absolute;
            width: 6px;
            height: 20px;
            background: linear-gradient(to top, #fff, #ff0);
            border-radius: 3px;
            animation: launch 1s ease-out forwards, burst 0.5s ease-out 1s forwards;
        }
        .firework::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 2px;
            height: 50px;
            background: linear-gradient(to bottom, rgba(255,255,0,0.8), transparent);
            animation: trail 1s ease-out forwards;
        }
        @keyframes launch {
            0% { transform: translateY(100vh); }
            100% { transform: translateY(50vh); }
        }
        @keyframes trail {
            0% { height: 0; opacity: 1; }
            100% { height: 50px; opacity: 0; }
        }
        @keyframes burst {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        .spark {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: #ff0000;
            border-radius: 50%;
            animation: spark 1.5s ease-out forwards;
        }
        @keyframes spark {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 1; }
            50% { transform: translate(var(--dx, 50px), var(--dy, -50px)) scale(2) rotate(180deg); opacity: 0.8; }
            100% { transform: translate(var(--dx, 100px), var(--dy, -100px)) scale(0) rotate(360deg); opacity: 0; }
        }
        #particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: rgba(255,255,255,0.5);
            border-radius: 50%;
            animation: float 10s linear infinite;
        }
        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); }
            100% { transform: translateY(-100px) rotate(360deg); }
        }
        #progress {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        #progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div id="particles"></div>

    <h1>لعبة ترتيب الحروف المبعثرة</h1>
    <p><a href="instructions.html">تعليمات اللعبة</a></p>
    <div id="game">
        <div id="level">المستوى: 1</div>
        <div id="timer">الوقت: 60</div>
        <div id="progress"><div id="progress-bar"></div></div>
        <div id="scrambled"></div>
        <div id="answer-area"></div>
        <button onclick="checkAnswer()">تحقق</button>
        <br>
        <button onclick="resetProgress()">إعادة تعيين التقدم</button>
        <div id="message"></div>
    </div>

    <div id="fireworks"></div>
    <div id="wrong-overlay"></div>

    <script>
        const words = [
            "كتاب", "مدرسة", "سيارة", "شجرة", "ماء", "شمس", "قمر", "نجم", "سماء", "أرض",
            "بحر", "جبل", "نهر", "غابة", "وردة", "ورد", "وردي", "أزرق", "أحمر", "أخضر",
            "أصفر", "أسود", "أبيض", "رمادي", "بني", "برتقالي", "وردي", "بنفسجي", "ذهبي", "فضي",
            "حديد", "نحاس", "فضة", "ذهب", "لؤلؤ", "ماس", "ياقوت", "زمرد", "يشم", "عقيق",
            "قطة", "كلب", "أسد", "فيل", "فأر", "خيل", "بقرة", "غنم", "دجاجة", "ديك",
            "بطة", "أوزة", "حمامة", "غراب", "عصفور", "نسر", "صقر", "بومة", "طاووس", "ديك رومي",
            "تفاحة", "برتقالة", "موز", "عنب", "تين", "خوخ", "كمثرى", "أناناس", "مانجو", "جوافة",
            "بطيخ", "شمام", "رمان", "ليمون", "برتقال", "جريب فروت", "فراولة", "توت", "كرز", "زيتون",
            "خبز", "أرز", "معكرونة", "بطاطس", "طماطم", "بصل", "ثوم", "جزر", "خيار", "فلفل",
            "ملح", "فلفل", "سكر", "زيت", "زبدة", "حليب", "جبن", "لبن", "زبادي", "عسل"
        ].sort((a, b) => a.length - b.length);

        let currentLevel = parseInt(localStorage.getItem('currentLevel')) || 0;
        let scrambledWord = '';
        let timer;
        let timeLeft;

        function scrambleWord(word) {
            let letters = word.split('');
            for (let i = letters.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [letters[i], letters[j]] = [letters[j], letters[i]];
            }
            return letters.join('');
        }

        function selectLetter(box) {
            let answerArea = document.getElementById('answer-area');
            let answerBox = document.createElement('div');
            answerBox.className = 'answer-letter';
            answerBox.textContent = box.textContent;
            answerBox.onclick = () => removeLetter(answerBox);
            answerArea.appendChild(answerBox);
            box.remove();
        }

        function removeLetter(box) {
            let scrambledDiv = document.getElementById('scrambled');
            let letterBox = document.createElement('div');
            letterBox.className = 'letter-box';
            letterBox.textContent = box.textContent;
            letterBox.onclick = () => selectLetter(letterBox);
            scrambledDiv.appendChild(letterBox);
            box.remove();
        }

        function launchFireworks() {
            let fireworks = document.getElementById('fireworks');
            fireworks.style.display = 'block';
            for (let i = 0; i < 10; i++) {
                // Rockets
                let rocket = document.createElement('div');
                rocket.className = 'firework';
                rocket.style.left = (Math.random() * 80 + 10) + '%';
                rocket.style.bottom = '0';
                fireworks.appendChild(rocket);
                setTimeout(() => {
                    // Sparks burst
                    for (let j = 0; j < 20; j++) {
                        let spark = document.createElement('div');
                        spark.className = 'spark';
                        spark.style.left = rocket.style.left;
                        spark.style.top = '50vh';
                        spark.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                        spark.style.setProperty('--dx', (Math.random() - 0.5) * 200 + 'px');
                        spark.style.setProperty('--dy', (Math.random() - 0.5) * 200 + 'px');
                        spark.style.animation = `spark 1.5s ease-out forwards`;
                        fireworks.appendChild(spark);
                        setTimeout(() => spark.remove(), 1500);
                    }
                    rocket.remove();
                }, 1000);
            }
            setTimeout(() => fireworks.style.display = 'none', 2500);
        }

        function loadLevel() {
            if (currentLevel < words.length) {
                scrambledWord = scrambleWord(words[currentLevel]);
                let scrambledDiv = document.getElementById('scrambled');
                scrambledDiv.innerHTML = '';
                for (let letter of scrambledWord) {
                    let box = document.createElement('div');
                    box.className = 'letter-box';
                    box.textContent = letter;
                    box.onclick = () => selectLetter(box);
                    scrambledDiv.appendChild(box);
                }
                document.getElementById('answer-area').innerHTML = '';
                document.getElementById('level').textContent = 'المستوى: ' + (currentLevel + 1);
                document.getElementById('message').textContent = '';
                document.getElementById('progress-bar').style.width = ((currentLevel + 1) / words.length * 100) + '%';
                // Start timer
                timeLeft = Math.max(5, 45 - currentLevel * 0.4);
                document.getElementById('timer').textContent = 'الوقت: ' + Math.ceil(timeLeft);
                clearInterval(timer);
                timer = setInterval(() => {
                    timeLeft -= 0.1;
                    document.getElementById('timer').textContent = 'الوقت: ' + Math.ceil(timeLeft);
                    if (timeLeft <= 0) {
                        clearInterval(timer);
                        document.getElementById('message').textContent = 'انتهى الوقت! حاول مرة أخرى.';
                        document.getElementById('message').className = 'incorrect';
                        setTimeout(() => {
                            document.getElementById('message').className = '';
                            loadLevel(); // restart level
                        }, 2000);
                    }
                }, 100);
            } else {
                clearInterval(timer);
                document.getElementById('message').textContent = 'تهانينا! أكملت جميع المستويات!';
                document.getElementById('scrambled').innerHTML = '';
                document.getElementById('answer-area').innerHTML = '';
                document.getElementById('progress-bar').style.width = '100%';
                document.getElementById('timer').textContent = '';
            }
        }

        function checkAnswer() {
            let answerLetters = Array.from(document.querySelectorAll('#answer-area .answer-letter')).map(el => el.textContent).join('');
            let messageDiv = document.getElementById('message');
            if (answerLetters === words[currentLevel]) {
                clearInterval(timer);
                messageDiv.textContent = 'صحيح! جيد جداً.';
                messageDiv.className = 'correct';
                launchFireworks();
                setTimeout(() => {
                    messageDiv.className = '';
                    nextLevel();
                }, 2000);
            } else {
                messageDiv.textContent = 'خطأ. حاول مرة أخرى.';
                messageDiv.className = 'incorrect';
                document.getElementById('wrong-overlay').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('wrong-overlay').style.display = 'none';
                    messageDiv.className = '';
                }, 1000);
            }
        }

        function nextLevel() {
            currentLevel++;
            localStorage.setItem('currentLevel', currentLevel);
            loadLevel();
        }

        function resetProgress() {
            currentLevel = 0;
            localStorage.setItem('currentLevel', 0);
            loadLevel();
        }

        loadLevel();

        // Create floating particles
        function createParticles() {
            let particles = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                let particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 10 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
                particles.appendChild(particle);
            }
        }
        createParticles();
    </script>
</body>
</html>
